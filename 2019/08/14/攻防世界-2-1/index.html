<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>攻防世界-2-1 | Steady</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="python之crc爆破">
<meta property="og:type" content="article">
<meta property="og:title" content="攻防世界-2-1">
<meta property="og:url" content="http://yoursite.com/2019/08/14/攻防世界-2-1/index.html">
<meta property="og:site_name" content="Steady">
<meta property="og:description" content="python之crc爆破">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/images/81.png">
<meta property="og:image" content="http://yoursite.com/images/82.png">
<meta property="og:image" content="http://yoursite.com/images/83.png">
<meta property="og:image" content="http://yoursite.com/images/84.png">
<meta property="og:updated_time" content="2019-08-14T07:11:28.629Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="攻防世界-2-1">
<meta name="twitter:description" content="python之crc爆破">
<meta name="twitter:image" content="http://yoursite.com/images/81.png">
  
    <link rel="alternate" href="/atom.xml" title="Steady" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Steady</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-攻防世界-2-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/14/攻防世界-2-1/" class="article-date">
  <time datetime="2019-08-14T07:02:23.000Z" itemprop="datePublished">2019-08-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CTF/">CTF</a>►<a class="article-category-link" href="/categories/CTF/杂项/">杂项</a>►<a class="article-category-link" href="/categories/CTF/杂项/修改高度和宽度/">修改高度和宽度</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      攻防世界-2-1
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>python之crc爆破</p>
<a id="more"></a>
<h4 id="python脚本之CRC爆破宽度和长度："><a href="#python脚本之CRC爆破宽度和长度：" class="headerlink" title="python脚本之CRC爆破宽度和长度："></a><strong>python脚本之CRC爆破宽度和长度：</strong></h4><p><strong>基础知识</strong><br>先详细解释一下png的文件头：</p>
<ul>
<li>（固定）八个字节89 50 4E 47 0D 0A 1A 0A为png的文件头</li>
<li>（固定）四个字节00 00 00 0D（即为十进制的13）代表数据块的长度为13</li>
<li>（固定）四个字节49 48 44 52（即为ASCII码的IHDR）是文件头数据块的标示（IDCH）</li>
<li>（可变）13位数据块（IHDR)<ul>
<li>前四个字节代表该图片的宽</li>
<li>后四个字节代表该图片的高</li>
<li>后五个字节依次为：<br>Bit depth、ColorType、Compression method、Filter method、Interlace method</li>
</ul>
</li>
<li>（可变）剩余四字节为该png的CRC检验码，由从IDCH到IHDR的十七位字节进行crc计算得到。<br>也就是说我们可以通过爆破来得到高度和宽度</li>
</ul>
<p><strong>理论依据</strong><br>png的CRC检验码，由从IDCH到IHDR的十七位字节进行crc计算得到。我们上图来解释一下：<br><img src="/images/81.png" alt="ac75291c5c164369c32efa3012cc0a09.png"><br>绿色的部分就是IHDR(代表图片的长和宽)+后五个字节一共是13个字节。黄色的部分就是图片的CRC值一共是四个字节。所以加起来就是十七个字节。<br><strong>目的：</strong><br>写python脚本以至于爆破出已知的的CRC对应的图片宽度或者高度。<br><strong>脚本：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line">m = open(<span class="string">"misc4.png"</span>,<span class="string">"rb"</span>).read()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1024</span>):</span><br><span class="line">    c = m[<span class="number">12</span>:<span class="number">16</span>] + struct.pack(<span class="string">'&gt;i'</span>, i) + m[<span class="number">20</span>:<span class="number">29</span>]</span><br><span class="line">    crc = binascii.crc32(c) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">if</span> crc == <span class="number">0x932f8a6b</span>:</span><br><span class="line">        print(i)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line">m = open(<span class="string">"1.png"</span>,<span class="string">"rb"</span>).read()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">65535</span>):</span><br><span class="line">    c = m[<span class="number">12</span>:<span class="number">20</span>] + struct.pack(<span class="string">'&gt;i'</span>, i) + m[<span class="number">24</span>:<span class="number">29</span>]</span><br><span class="line">    crc = binascii.crc32(c) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">if</span> crc == <span class="number">0x6F03AD71</span>:</span><br><span class="line">        print(hex(i))</span><br></pre></td></tr></table></figure>

<p><strong>脚本分析：</strong><br>1.open()<br>打开一张图片，rb是指以二进制格式打开一个文件用于只读。文件指针将会放在文件的开头。这是默认模式。<br>.read([size])：size 未指定则返回整个文件，如果文件大小 &gt;2 倍内存则有问题，f.read()读到文件尾时返回””(空字串)。也就是读取图片的意思，<br>2.struct.pack(‘&gt;i’, i)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">struct — Interpret bytes as packed binary data</span><br><span class="line"></span><br><span class="line">将字节解释为压缩二进制数据</span><br><span class="line"></span><br><span class="line">struct.pack(format, v1, v2, ...)</span><br><span class="line"></span><br><span class="line">Return a bytes object containing the values v1, v2, … packed according to the format string format. The arguments must match the values required by the format exactly.</span><br><span class="line"></span><br><span class="line">返回一个字节对象，该对象包含根据格式字符串格式打包的值v1、v2，…。参数必须与格式要求的值完全匹配。</span><br><span class="line"></span><br><span class="line">第一个参数是后面所有参数的格式字符串，后面的每个参数必须与格式字符串描述一致。</span><br><span class="line"></span><br><span class="line">eg:h表示short，l表示long； &apos;hhl&apos;表示后面有三个参数，依次是short，short，long类型</span><br><span class="line"></span><br><span class="line"> c表示 char，bytes of length 1（长度的byte数组），i表示integer 整数；&apos;ci&apos;表示后面有两个个参数，依次是char，integer 类型</span><br></pre></td></tr></table></figure>

<p>struct的pack函数把任意数据类型变成字符串：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line">struct.pack(<span class="string">'&gt;I'</span>, <span class="number">10240099</span>)</span><br><span class="line"><span class="string">'\x00\x9c@c'</span></span><br></pre></td></tr></table></figure>

<p>‘pack的第一个参数是处理指令，’&gt;I’的意思是：&gt;表示字节顺序是big-endian，也就是网络序，I表示4字节无符号整数(四个字节正好对应winhex中的高或者宽)。<br>说白了就是进行一个数据转换问题。<br>因为我们在for i in range中的i是一个整数，但是我们需要与winhex中的数据 进行拼接，所以理所应当的进行数据转化。<br>4.crc = binascii.crc32(c) &amp; 0xffffffff<br>这句话就是将c的值利用binascii模块的crc方法转化为crc，<strong>关于后面的0xffffff</strong>：</p>
<p>在 Python 2.x 的版本中，binascii.crc32 所计算出來的 CRC 值域为[-2^31, 2^31-1] 之间的有符号整数，为了要与一般CRC 结果作比对，需要将其转为无符号整数，所以加上&amp; 0xffffffff来进行转换。如果是 Python 3.x 的版本，其计算结果为 [0, 2^32-1] 间的无符号整数，因此不需额外加上&amp; 0xffffffff 。<br>5.c = m[12:16] + struct.pack(‘&gt;i’, i) + m[20:29]<br>这句话理解比较好理解但是我在m[12:16]这里比较疑惑，就是说到底包不包含第12或者第16?<br><img src="/images/82.png" alt="d89f0c4d8ebe649b6f8b4630ddddb2be.png"><br>因此我们可以看到python中是从0开始的而且不包括后面的数组类似开区间和闭区间。<br><img src="/images/83.png" alt="2e5a4ad45a5ae05f066bf924a9ed918a.png"><br>m[12:16]：第一行的49到第二行的00(但是不包括)<br>m[20:29]：第二行的第五个00到第二行的93(不包括)，93恰好是crc值的第一个值。<br>所以中间的就是我们要爆破出来的宽度。(宽度是四个字节我们在这里只是把十进制数变成了十六进制)</p>
<ol start="5">
<li>os模块<br>在自动化测试中，经常需要查找操作文件，比如说查找配置文件（从而读取配置文件的信息），查找测试报告（从而发送测试报告邮件），经常要对大量文件和大量路径进行操作，这就依赖于os模块。</li>
</ol>
<hr>
<p>最终结果：<br><img src="/images/84.png" alt="95886dd13910b6b7952831561a05ea85.png"><br>最后我加一个print(hex(i))，毕竟还要在winhex中修改哎<br>ps：<br>这道题的思路就是注意图片属性可能找不到高度和宽度信息，而且winhex中的宽度和高度数据不正常。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/08/14/攻防世界-2-1/" data-id="cjzo6xjva000vi8wgqifdab8m" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/08/14/BUGKU-好多压缩包/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          BUGKU--好多压缩包
        
      </div>
    </a>
  
  
    <a href="/2019/08/14/BUGKU-论剑/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">BUGKU-论剑</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/Jarvis-OJ/">Jarvis-OJ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/SQL注入/">SQL注入</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/i春秋/">i春秋</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/杂项/">杂项</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/杂项/修改高度和宽度/">修改高度和宽度</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux基础/">Linux基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/内核/">内核</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/PYTHON/">PYTHON</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/PYTHON/信息收集脚本/">信息收集脚本</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PYTHON/模块实例解析/">模块实例解析</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂谈/">杂谈</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞原理/">漏洞原理</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞原理/Git源码泄露/">Git源码泄露</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞原理/SQL注入/">SQL注入</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞原理/xxe漏洞/">xxe漏洞</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞原理/上传漏洞/">上传漏洞</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞原理/文件上传/">文件上传</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞原理/解析漏洞/">解析漏洞</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jarvis-OJ-wp/">Jarvis OJ wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jarvis-OJ/">Jarvis-OJ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/">sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/杂谈/">杂谈</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/解析漏洞/">解析漏洞</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Jarvis-OJ-wp/" style="font-size: 10px;">Jarvis OJ wp</a> <a href="/tags/Jarvis-OJ/" style="font-size: 10px;">Jarvis-OJ</a> <a href="/tags/sql/" style="font-size: 20px;">sql</a> <a href="/tags/杂谈/" style="font-size: 10px;">杂谈</a> <a href="/tags/解析漏洞/" style="font-size: 10px;">解析漏洞</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/08/23/CGI-FastCGI学习/">CGI/FastCGI学习</a>
          </li>
        
          <li>
            <a href="/2019/08/23/SAPI接口/">SAPI接口</a>
          </li>
        
          <li>
            <a href="/2019/08/23/Git源码泄露/">Git源码泄露</a>
          </li>
        
          <li>
            <a href="/2019/08/17/python之zipfile模块-2/">python之zipfile模块-2</a>
          </li>
        
          <li>
            <a href="/2019/08/17/upload-labs-三/">upload-labs-三</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 新boy<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>
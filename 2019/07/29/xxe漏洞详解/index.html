<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>xxe漏洞详解 | Steady</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="XML用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言。">
<meta name="keywords" content="杂谈">
<meta property="og:type" content="article">
<meta property="og:title" content="xxe漏洞详解">
<meta property="og:url" content="http://yoursite.com/2019/07/29/xxe漏洞详解/index.html">
<meta property="og:site_name" content="Steady">
<meta property="og:description" content="XML用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://i2.tiimg.com/695378/634d8ce1313fad33.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/971e62b5bcdaa269.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/8f35a560d5a8c404.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/c9d358633c27f111.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/5bd0cb96442f3edf.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/c9d358633c27f111.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/a7bd7a6619c5b264.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/1e172cec82f33bd4.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/869db5e01e30f374.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/7cb4544fa53ffe04.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/2c6deb9f66be4a7d.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/926cc6a23fe1c167.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/3231f5eae2451e14.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/6756248887341bbe.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/aaddff04e8f90b30.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/256d4677874e03e4.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/0300f4994c4da7e9.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/38eee370e7c5b3d6.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/81ccc8efd99e7315.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/49f8be7b93ee2691.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/198f1aecff208552.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/2c14d9a1e4d6bcc2.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/22f69eed6b970594.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/e2d935e4840a0524.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/ce9498b7c79f46b4.png">
<meta property="og:image" content="http://i2.tiimg.com/695378/d77788d8d27425d5.png">
<meta property="og:updated_time" content="2019-08-03T06:04:39.602Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="xxe漏洞详解">
<meta name="twitter:description" content="XML用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言。">
<meta name="twitter:image" content="http://i2.tiimg.com/695378/634d8ce1313fad33.png">
  
    <link rel="alternate" href="/atom.xml" title="Steady" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Steady</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-xxe漏洞详解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/29/xxe漏洞详解/" class="article-date">
  <time datetime="2019-07-29T01:52:57.000Z" itemprop="datePublished">2019-07-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/漏洞原理/">漏洞原理</a>►<a class="article-category-link" href="/categories/漏洞原理/xxe漏洞/">xxe漏洞</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      xxe漏洞详解
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>XML用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言。</p>
<a id="more"></a>
<h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a><strong>基础知识</strong></h3><hr>
<hr>
<h4 id="XML基础知识"><a href="#XML基础知识" class="headerlink" title="XML基础知识"></a><strong>XML基础知识</strong></h4><p>XML用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言。XML文档结构包括XML声明、DTD文档类型定义（可选）、文档元素。—-看了之后是不是很牛逼？高大上？其实百分之99的人看不懂。下面来点通俗的讲解：<br>      简单概括的话就是，xml本身是一种格式规范，是一种包含了数据以及数据说明的文本格式规范。<br>比如，我们要给对方传输一段数据，数据内容是“too young,too simple,sometimes naive”，要将这段话按照属性拆分为三个数据的话，就是，年龄too young，阅历too simple，结果sometimes naive。</p>
<pre><code>我们都知道程序不像人，可以体会字面意思，并自动拆分出数据，因此，我们需要帮助程序做拆分，因此出现了各种各样的数据格式以及拆分方式。比如，可以是这样的数据为“too young,too simple,sometimes naive”然后按照逗号拆分，第一部分为年龄，第二部分为阅历，第三部分为结果。也可以是这样的数据为“too_young**too_simple*sometimes_naive”从数据开头开始截取前面十一个字符，去掉*号并把下划线替换为空格作为第一部分，再截取接下来的十一个字符同样去掉*并替换下划线为空格作为第二部分，最后把剩下的字符同样去*号体会空格作为第三部分。
这两种方式都可以用来容纳数据并能够被解析，但是不直观，通用性也不好，而且如果出现超过限定字数的字符串就容纳不了，也可能出现数据本身就下划线字符导致需要做转义。基于这种情况，出现了xml这种数据格式， 上面的数据用XML表示的话</code></pre><p>可以是这样</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">person</span> <span class="attr">age</span>=<span class="string">"too young"</span> <span class="attr">experience</span>=<span class="string">"too simple"</span> <span class="attr">result</span>=<span class="string">"sometimes naive"</span> /&gt;</span></span><br><span class="line">也可以是这样</span><br><span class="line"><span class="tag">&lt;<span class="name">person</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">age</span> <span class="attr">value</span>=<span class="string">"too young"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">experience</span> <span class="attr">value</span>=<span class="string">"too simple"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">value</span>=<span class="string">"sometimes naive"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">person</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>两种方式都是xml，都很直观，附带了对数据的说明，并且具备通用的格式规范可以让程序做解析。<br>如果用json格式来表示的话，就是下面这样<br>{<br>    “age”:”too young”,<br>    “experience”:”too simple”,<br>    “result”:”sometimes naive”<br>}<br>其实数据都是一样的，不同的只是数据的格式而已，同样的数据，我用xml格式传给你，你用xml格式解析出三个数据，用json格式传给你，你就用json格式解析出三个数据，还可以我本地保存的是xml格式的数据，我自己先解析出三个数据，然后构造成json格式传给你，你解析json格式，获得三个数据，再自己构造成xml格式保存起来，说白了，不管是xml还是json，都只是包装数据的不同格式而已，重要的是其中含有的数据，而不是包装的格式。<br><img src="http://i2.tiimg.com/695378/634d8ce1313fad33.png" alt="258b2b9b634d8ce1313fad3390807007.png"></p>
<hr>
<hr>
<p><strong>DTD（文档类型定义）的作用是定义 XML 文档的合法构建模块。DTD 可以在 XML 文档内声明，也可以外部引用。</strong><br>内部声明DTD</p>
<p>根元素 [元素声明]&gt;</p>
<p>引用外部DTD</p>
<p>根元素 SYSTEM “文件名”&gt;<br>或者<br>根元素 PUBLIC “public_ID” “文件名”&gt;** //注意文件包含漏洞</p>
<p><strong>DTD实体是用于定义引用普通文本或特殊字符的快捷方式的变量，可以内部声明或外部引用。</strong></p>
<p>内部声明实体</p>
<p>实体名称 “实体的值”&gt;</p>
<p>引用外部实体实体</p>
<p>名称 SYSTEM “URI”&gt;  //注意ssrf漏洞</p>
<p>或者</p>
<p>实体名称 PUBLIC “public_ID” “URI”&gt;</p>
<hr>
<hr>
<h4 id="DTD基础知识"><a href="#DTD基础知识" class="headerlink" title="DTD基础知识"></a><strong>DTD基础知识</strong></h4><p>在信息的高速交流中，不同领域之间的信息交换越来越紧密，如何才能保证这些不同领域之间的信息可以更容易且更有效率地交换成为我们首要关注的问题。为了解决这个问题，就需要不同的领域来针对领域的特性制定共同的信息内容模型（content model），然后再通过这个共同的内容模型来标识信息。而DTD就是一种内容模型。 DTD（文档类型定义）可以定义合法的XML文档结构，它使用一系列合法元素来定义文档的结构。DTD分为内部DTD和外部DTD，所谓内部DTD是指该DTD在某个文档的内部，只被该文档使用。外部DTD是指该DTD不在文档内部，可以被其他所有的文档来共享。DTD文档与XML文档实例的关系可以看成是类和对象的关系。 DTD的优势 每一个XML文档都可携带一个DTD，用来对该文档格式进行描述，测试该文档是否为有效的XML文档。既然DTD有外部和内部之分，当然就可以为某个独立的团体定义一个公用的外部DTD，那么多个XML文档就都可以共享使用该DTD，使得数据交换更为有效。甚至在某些文档中还可以使内部DTD和外部DTD相结合。在应用程序中也可以用某个DTD来检测接收到的数据是否符合某个标准。 对于XML文档而言，虽然DTD不是必须的，但它为文档的编制带来了方便。加强了文档标记内参数的一致性，使XML语法分析器能够确认文档。如果不使用DTD来对XML文档进行定义，那么XML语法分析器将无法对该文档进行确认。<br>举个例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">stu</span> <span class="attr">id</span>=<span class="string">"a&amp;quot;0&amp;apos;0&amp;apos;1&amp;lt;"</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>杨过<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sex</span>&gt;</span>男<span class="tag">&lt;/<span class="name">sex</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">age</span>&gt;</span>30<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">介绍</span>&gt;</span>我是好人<span class="tag">&lt;/<span class="name">介绍</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">面积</span>&gt;</span>100平<span class="tag">&lt;/<span class="name">面积</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">stu</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>xml过于自由。<br>快速入门案例<br>基本语法是:<br><!ELEMENT 元素名 类型></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--引入dtd去约束该xml文件--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE 班级 SYSTEM "myClass2.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">班级</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">学生</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">名字</span>&gt;</span>周星驰<span class="tag">&lt;/<span class="name">名字</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">年龄</span>&gt;</span>23<span class="tag">&lt;/<span class="name">年龄</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">介绍</span>&gt;</span>学习刻苦<span class="tag">&lt;/<span class="name">介绍</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">学生</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">学生</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">名字</span>&gt;</span>林青霞<span class="tag">&lt;/<span class="name">名字</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">年龄</span>&gt;</span>32<span class="tag">&lt;/<span class="name">年龄</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">介绍</span>&gt;</span>是一个好学生<span class="tag">&lt;/<span class="name">介绍</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">学生</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">班级</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">myClass2.dtd</span><br><span class="line"><span class="tag">&lt;<span class="name">!ELEMENT</span> 班级 (学生+)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">!ELEMENT</span> 学生 (名字,年龄,介绍)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">!ELEMENT</span> 名字 (#<span class="attr">PCDATA</span>)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">!ELEMENT</span> 年龄 (#<span class="attr">PCDATA</span>)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">!ELEMENT</span> 介绍 (#<span class="attr">PCDATA</span>)&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<hr>
<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a><strong>漏洞利用</strong></h3><hr>
<hr>
<h4 id="XML外部实体注入-XML-External-Entity"><a href="#XML外部实体注入-XML-External-Entity" class="headerlink" title="XML外部实体注入(XML External Entity)"></a><strong>XML外部实体注入(XML External Entity)</strong></h4><p>当允许引用外部实体时，通过构造恶意内容，可导致读取任意文件、执行系统命令、探测内网端口、攻击内网网站等危害。 引入外部实体方式有多种，比如：<br>恶意引入外部实体方式1：<br>XML内容：<br><img src="http://i2.tiimg.com/695378/971e62b5bcdaa269.png" alt="a70b7220971e62b5bcdaa269d99bf8ea.png"><br>恶意引入外部实体方式2：<br>XML内容：<br><img src="http://i2.tiimg.com/695378/8f35a560d5a8c404.png" alt="3d7224f68f35a560d5a8c4048effabaa.png"><br>DTD文件(evil.dtd)内容：<br><img src="http://i2.tiimg.com/695378/c9d358633c27f111.png" alt="5fd617485bd0cb96442f3edf7b0fbf4d.png"><br>恶意引入外部实体方式3：<br>XML内容：<br><img src="http://i2.tiimg.com/695378/5bd0cb96442f3edf.png" alt="5fd617485bd0cb96442f3edf7b0fbf4d.png"><br>DTD文件(evil.dtd)内容：<br><img src="http://i2.tiimg.com/695378/c9d358633c27f111.png" alt="2964602ac9d358633c27f111741353d5.png"><br>另外，不同程序支持的协议不一样，<br><img src="http://i2.tiimg.com/695378/a7bd7a6619c5b264.png" alt="0ad9f435a7bd7a6619c5b264c42b4f23.png"><br>上图是默认支持协议，还可以支持其他，如PHP支持的扩展协议有<br><img src="http://i2.tiimg.com/695378/1e172cec82f33bd4.png" alt="f158f86b1e172cec82f33bd41450db2c.png"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" standalone="no"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE root SYSTEM "http://www.test.org/test.dtd"&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>对于以上的一些代码我们做一些解释：</strong><br>DOCTYPE分析<br>DTD声明始终以!DOCTYPE开头,空一格后跟着文档根元素的名称,如果是内部DTD,则再空一格出现[],在中括号中是文档类型定义的内容. 而对于外部DTD,则又分为私有DTD与公共DTD,私有DTD使用SYSTEM表示,接着是外部DTD的URL. 而公共DTD则使用PUBLIC,接着是DTD公共名称,接着是DTD的URL.下面是一些示例<br>公共DTD,DTD名称格式为”注册//组织//类型 标签//语言”,”注册”指示组织是否由国际标准化组织(ISO)注册,+表示是,-表示不是.”组织”即组织名称,如:W3C; “类型”一般是DTD,”标签”是指定公开文本描述，即对所引用的公开文本的唯一描述性名称,后面可附带版本号。最后”语言”是DTD语言的ISO 639语言标识符,如:EN表示英文,ZH表示中文,在下面的地址有完整的ISO 639语言标识符列表[url]<a href="http://ftp.ics.uci.edu/pub/ietf/http/related/iso639.txt" target="_blank" rel="noopener">http://ftp.ics.uci.edu/pub/ietf/http/related/iso639.txt</a> [/url] </p>
<h4 id="以下举例说明XXE危害，当然XXE不止这些危害。"><a href="#以下举例说明XXE危害，当然XXE不止这些危害。" class="headerlink" title="以下举例说明XXE危害，当然XXE不止这些危害。"></a><strong>以下举例说明XXE危害，当然XXE不止这些危害。</strong></h4><p>XXE危害1：读取任意文件<br><img src="http://i2.tiimg.com/695378/869db5e01e30f374.png" alt="a6d23109869db5e01e30f374bf494275.png"><br><img src="http://i2.tiimg.com/695378/7cb4544fa53ffe04.png" alt="6a5ade407cb4544fa53ffe04329bdfdb.png"></p>
<p>该CASE是读取/etc/passwd，有些XML解析库支持列目录，攻击者通过列目录、读文件，获取帐号密码后进一步攻击，如读取tomcat-users.xml得到帐号密码后登录tomcat的manager部署webshell。<br> 另外，数据不回显就没有问题了吗？如下图，<br> <img src="http://i2.tiimg.com/695378/2c6deb9f66be4a7d.png" alt="2552bee32c6deb9f66be4a7dced17379.png"></p>
<p>不，可以把数据发送到远程服务器，<br><img src="http://i2.tiimg.com/695378/926cc6a23fe1c167.png" alt="d3a6fb3a926cc6a23fe1c1672c8055d5.png"><br>远程evil.dtd文件内容如下：<br><img src="http://i2.tiimg.com/695378/3231f5eae2451e14.png" alt="b0ed113b3231f5eae2451e1472262ff5.png"><br>触发XXE攻击后，服务器会把文件内容发送到攻击者网站<br><img src="http://i2.tiimg.com/695378/6756248887341bbe.png" alt="2efb47426756248887341bbeafb3a18c.png"><br><img src="http://i2.tiimg.com/695378/aaddff04e8f90b30.png" alt="3c8d7461aaddff04e8f90b30f0d3ed8d.png"></p>
<p><strong>XXE危害2：执行系统命令</strong><br><img src="http://i2.tiimg.com/695378/256d4677874e03e4.png" alt="b2534e5f256d4677874e03e482207390.png"><br><img src="http://i2.tiimg.com/695378/0300f4994c4da7e9.png" alt="3d2816190300f4994c4da7e9fab2d0f0.png"><br> 该CASE是在安装expect扩展的PHP环境里执行系统命令，其他协议也有可能可以执行系统命令。</p>
<p><strong>XXE危害3：探测内网端口</strong><br><img src="http://i2.tiimg.com/695378/38eee370e7c5b3d6.png" alt="fdf13f2238eee370e7c5b3d67fb241be.png"><br><img src="http://i2.tiimg.com/695378/81ccc8efd99e7315.png" alt="168daa5c81ccc8efd99e7315c90e8d87.png"><br> 该CASE是探测192.168.1.1的80、81端口，通过返回的“Connection refused”可以知道该81端口是closed的，而80端口是open的。</p>
<p><strong>XXE危害4：攻击内网网站</strong><br><img src="http://i2.tiimg.com/695378/49f8be7b93ee2691.png" alt="952b814849f8be7b93ee269174440450.png"><br><img src="http://i2.tiimg.com/695378/198f1aecff208552.png" alt="52f0bec6198f1aecff208552222b9853.png"><br>该CASE是攻击内网struts2网站，远程执行系统命令。</p>
<h4 id="客户端XXE案例"><a href="#客户端XXE案例" class="headerlink" title="客户端XXE案例"></a><strong>客户端XXE案例</strong></h4><p>日前，某office文档转换软件被爆存在XXE漏洞（PS:感谢TSRC平台白帽子Titans)报告告漏洞），某一应用场景为：Web程序调用该office软件来获取office文档内容后提供在线预览。由于该软件在处理office文档时，读取xml文件且允许引用外部实体，当用户上传恶意文档并预览时触发XXE攻击。详情如下：<br>新建一个正常文档，内容为Hi TSRC，<br><img src="http://i2.tiimg.com/695378/2c14d9a1e4d6bcc2.png" alt="62b38e002c14d9a1e4d6bcc21b21221c.png"><br> 使用该软件转换后可以得到文本格式的文档内容，<br> <img src="http://i2.tiimg.com/695378/22f69eed6b970594.png" alt="093e889722f69eed6b9705942aa97fec.png"><br> <img src="http://i2.tiimg.com/695378/e2d935e4840a0524.png" alt="87d9823de2d935e4840a05242dc0c9c9.png"><br>  当往该docx的xml文件注入恶意代码（引用外部实体）时，可进行XXE攻击。<br>  <img src="http://i2.tiimg.com/695378/ce9498b7c79f46b4.png" alt="d2e5f382ce9498b7c79f46b4fb5778bb.png"><br>  <img src="http://i2.tiimg.com/695378/d77788d8d27425d5.png" alt="4465391cd77788d8d27425d5d1fe7841.png"></p>
<hr>
<h3 id="防御XXE攻击"><a href="#防御XXE攻击" class="headerlink" title="防御XXE攻击"></a><strong>防御XXE攻击</strong></h3><hr>
<p>方案一、使用开发语言提供的禁用外部实体的方法<br>PHP：libxml_disable_entity_loader(true);</p>
<p>其他语言:<a href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Prevention_Cheat_Sheet" target="_blank" rel="noopener">https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Prevention_Cheat_Sheet</a><br> 方案二、过滤用户提交的XML数据       关键词：，SYSTEM和PUBLIC。 </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/07/29/xxe漏洞详解/" data-id="cjzo6xjwh002ni8wgjcywow93" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/杂谈/">杂谈</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/07/29/python-scoket主机识别/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          python-scoket主机识别
        
      </div>
    </a>
  
  
    <a href="/2019/07/29/Jarvis-OJ-api调用/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Jarvis-OJ-api调用</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/Jarvis-OJ/">Jarvis-OJ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/SQL注入/">SQL注入</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/i春秋/">i春秋</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/杂项/">杂项</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/杂项/修改高度和宽度/">修改高度和宽度</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux基础/">Linux基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/内核/">内核</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/PYTHON/">PYTHON</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/PYTHON/信息收集脚本/">信息收集脚本</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PYTHON/模块实例解析/">模块实例解析</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂谈/">杂谈</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞原理/">漏洞原理</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞原理/Git源码泄露/">Git源码泄露</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞原理/SQL注入/">SQL注入</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞原理/xxe漏洞/">xxe漏洞</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞原理/上传漏洞/">上传漏洞</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞原理/文件上传/">文件上传</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/漏洞原理/解析漏洞/">解析漏洞</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jarvis-OJ-wp/">Jarvis OJ wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jarvis-OJ/">Jarvis-OJ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/">sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/杂谈/">杂谈</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/解析漏洞/">解析漏洞</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Jarvis-OJ-wp/" style="font-size: 10px;">Jarvis OJ wp</a> <a href="/tags/Jarvis-OJ/" style="font-size: 10px;">Jarvis-OJ</a> <a href="/tags/sql/" style="font-size: 20px;">sql</a> <a href="/tags/杂谈/" style="font-size: 10px;">杂谈</a> <a href="/tags/解析漏洞/" style="font-size: 10px;">解析漏洞</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/08/23/CGI-FastCGI学习/">CGI/FastCGI学习</a>
          </li>
        
          <li>
            <a href="/2019/08/23/SAPI接口/">SAPI接口</a>
          </li>
        
          <li>
            <a href="/2019/08/23/Git源码泄露/">Git源码泄露</a>
          </li>
        
          <li>
            <a href="/2019/08/17/python之zipfile模块-2/">python之zipfile模块-2</a>
          </li>
        
          <li>
            <a href="/2019/08/17/upload-labs-三/">upload-labs-三</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 新boy<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>